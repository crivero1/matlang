%Probably the longest section.


%\begin{itemize}
%\item Define the syntax and the semantics of for loop language. 
%\item Examples:
%\begin{itemize}
%\item Simple queries (cover \lang\)
%\item Elementary operations
%\item How to define order (the $Z$ matrix, $v_{max}$,...)
%\item Standard Linear Algebra algorithms:
%\begin{itemize}
%\item Gaussian elimination
%\item Inverse
%\item Determinant
%\item $LU$
%\item $\cdots$
%\end{itemize}
%\end{itemize}
%\end{itemize}

While \lang\ serves as a solid basis for expressing linear algebra properties, it is still somewhat lacking when defining more advanced linear algebra operators such as Gaussian eliminations, or computing an inverse of a matrix. To alleviate these issues, we propose an extended version of \lang, called \lang++ which allows us to express such properties.

As before, we assume a countably infinite set of matrix variables $\Mvar = \{V_1, V_2, \ldots\}$, and a set $\Fun$  of functions $f:\mathbb{C}^n \mapsto \mathbb{C}$. The syntax of \lang++ is defined as follows:


\medskip

\begin{tabular}{lcll}
$e$ & $::=$ & $V\in \Mvar$ & (matrix variable)\\
 & $|$ & $e^*$ & (conjugate transpose)\\ 
 & $|$ & $e_1 \cdot e_2$ & (matrix multiplication)\\   
 & $|$ & $e_1 + e_2$ & (matrix addition)\\    
 & $|$ & $f(e_1,\ldots ,e_n)$ & (application of $f\in \Fun$)\\
 & $|$ & $\ffor{v}{X}{e}$ & (canonical for loop). 
\end{tabular}

\medskip

A \lang++ {\em schema} $\Sch$ is a pair $\Sch=(\Mnam,\size)$, where $\Mnam\subset \Mvar$ is a finite set of matrix variables, and $\size: \Mvar \mapsto \DD\times \DD$ is a function that maps each matrix variable to a pair of {\em size symbols}. Given a schema $\Sch$, the type of a \lang++ expression, denoted $\type(e)^{\Sch}$, is defined inductively as follows:
\begin{itemize}
\item $\type(V)^{\Sch} = \size(V)$, for a matrix variable $V$;
\item $\type(e^*)^{\Sch} = (\beta,\alpha)$, if $\type(e)^{\Sch}=(\alpha,\beta)$, and undefined if $\type(e)^{\Sch}$ is undefined;
\item $\type(e_1 \cdot e_2)^{\Sch} = (\alpha,\gamma)$, if $\type(e_1)^{\Sch}=(\alpha,\beta)$, and $\type(e_2)^{\Sch}=(\beta,\gamma)$, and is undefined otherwise;
\item $\type(e_1 + e_2)^{\Sch} = \type(e_1)^{\Sch}$, if $\type(e_1)^{\Sch} = \type(e_2)^{\Sch}$, and is undefined otherwise;
\item $\type(f(e_1,\ldots ,e_n))^{\Sch} = (1,1)$, if $\type(e_1)^{\Sch}= \cdots =\type(e_n)^{\Sch}=(1,1)$, and $f:\mathbb{C}^n\mapsto \mathbb{C}$, and is undefined otherwise; and
\item $\type(\ffor{v}{X}{e})^{\Sch} = \type(e)^{\Sch}$, if $\type(v)^{\Sch} = (\alpha,1)$, and is undefined otherwise.
\end{itemize}

An expression $e$ is well-typed over a schema $\Sch$ if its type is defined. For well-typed expressions we can define the evaluation as follows.
%
A \lang++ {\em instance} $\I$ over a schema $\Sch$, is a pair $\I = (\dom,\conc)$, where $\dom : \DD \mapsto \mathbb{N}$ assigns a value to each size symbol, and $\conc : \Mnam \mapsto \mtr{\mathbb{C}}$ assigns a concrete matrix to each matrix variable $M\in \Mnam$, such that $\dim(\conc(M)) = \dom(\alpha)\times \dom(\beta)$, where $\size(M) = (\alpha,\beta)$. As before, we assume that $\dom(1) = 1$, for every instance $\I$. Additionally, we assume that each instance $\I$ has a countably infinite set of canonical vectors of arbitrary dimension. That is, for each $n\in \mathbb{N}$, we assume that vector variables $e_1^n,\ldots ,e_n^n$ store the complete list of canonical vectors of dimension $n$, where $e_1^n = [1\ 0 \cdots 0]^*$, $e_2^n = [0\ 1\ 0 \cdots 0]^*$, etc.
 %(meaning that $e_1^n = \begin{bmatrix} 1 \\ 0 \\ \vdots \\ 0 \end{bmatrix}$, etc.).
If $\I$ is an instance, $V$ a matrix variable such that $\size(V)= (\alpha,\beta)$, and $M$ a matrix of dimension $\dom(\alpha)\times \dom(\beta)$, then $\I[V := X]$ denotes an instance that coincides with $\I$, apart from the fact that the value of the matrix variable $V$ is the matrix $M$. 
If $e$ is a well-typed expression according to $\Sch$, then we denote by $\sem{e}_\I$ the matrix obtained by evaluating $e$ over $\I$, and define it as follows:
\begin{itemize}
\item $\sem{M}_\I = \conc(M)$, for $M\in \Mnam$;
\item $\sem{e^*}_\I = \sem{e}_\I^*$, where $M^*$ is the conjugate transpose of a matrix $M$;
\item $\sem{e_1\cdot e_2}_\I = \sem{e_1}_\I \cdot \sem{e_2}_\I$;
\item $\sem{e_1 + e_2}_\I = \sem{e_1}_\I + \sem{e_2}_\I$;
\item $\sem{f(e_1,\ldots ,e_n)}_\I$ is a $1\times 1$ matrix whose only entry has the value $f(\sem{e_1}_\I,\ldots ,\sem{e_n}_\I)$. Here we abuse the notation and use $\sem{e}_\I$ to denote both a $1\times 1$ matrix, and a scalar from $\mathbb{C}$.
\end{itemize}

The semantics of $\ffor{v}{X}{e}$ over $\I$ is defined iteratively as follows:
\begin{itemize}
\item Let $\type(v)= (\gamma,1)$, and $\type(e) = (\alpha,\beta)$. Define $n := \dom(\gamma)$.
\item Set $A_0 = \mathbf{0}$, is the null matrix of size $\dom(\alpha)\times \dom(\beta)$.
\item For $i=1,\ldots n$, compute $A_i = \sem{e}_{\I[v := e^{n}_i, X:= A_{i-1}]}$.
\item Finally, set $\sem{\ffor{v}{X}{e}}_\I = A_{n}$.
\end{itemize}

